// Singularity configuration - will use NXF_SINGULARITY_CACHEDIR automatically
singularity {
    enabled = true
    autoMounts = true
    pullTimeout = '30m'
}

// Disable other container systems
docker.enabled = false
podman.enabled = false
conda.enabled = false

params {
    // Input parameters
    input = null  // CSV samplesheet path
    outdir = "results"
    
    // Reference genome
    fasta = null  // Path to yeast reference genome
    
    // Optional parameters
    skip_fastqc = false
    skip_multiqc = false
    skip_bigwig = false
    
}

// Capture exit codes from upstream processes when piping
process.shell = ['/bin/bash', '-euo', 'pipefail']

// Process resource labels optimized for typical Linux workstations
process {
    withLabel: process_low {
        cpus = 2
        memory = 4.GB
        time = 2.h
    }
    withLabel: process_medium {
        cpus = 4
        memory = 8.GB
        time = 4.h
    }
    withLabel: process_high {
        cpus = 8
        memory = 16.GB
        time = 8.h
    }
    
    // Process-specific containers
    withName: 'YEAST_ALIGNMENT:FASTQC' {
        container = 'https://depot.galaxyproject.org/singularity/fastqc:0.12.1--hdfd78af_0'
    }
    withName: 'YEAST_ALIGNMENT:CONCATENATE_GENOME' {
        container = 'https://depot.galaxyproject.org/singularity/ubuntu:20.04'
    }
    withName: 'YEAST_ALIGNMENT:BWA_INDEX' {
        container = 'https://depot.galaxyproject.org/singularity/bwa:0.7.18--he4a0461_0'
    }
    withName: 'YEAST_ALIGNMENT:BWA_ALIGN' {
        container = 'https://depot.galaxyproject.org/singularity/mulled-v2-fe8faa35dbf6dc65a0f7f5d4ea12e31a79f73e40:66ed1b38d280722529bb8a0167b0cf02f8a0b488-0'
    }
    withName: 'YEAST_ALIGNMENT:SAMTOOLS_SORT' {
        container = 'https://depot.galaxyproject.org/singularity/samtools:1.21--h50ea8bc_0'
    }
    withName: 'YEAST_ALIGNMENT:SAMTOOLS_INDEX' {
        container = 'https://depot.galaxyproject.org/singularity/samtools:1.21--h50ea8bc_0'
    }
    withName: 'YEAST_ALIGNMENT:BAMCOVERAGE_BIGWIG' {
        container = 'https://depot.galaxyproject.org/singularity/deeptools:3.5.4--pyhdfd78af_0'
    }
    withName: 'YEAST_ALIGNMENT:SAMTOOLS_FAIDX' {
        container = 'https://depot.galaxyproject.org/singularity/samtools:1.21--h50ea8bc_0'
    }
    withName: 'YEAST_ALIGNMENT:MULTIQC' {
        container = 'https://depot.galaxyproject.org/singularity/multiqc:1.25--pyhdfd78af_0'
    }
}

// Executor configuration for local execution
executor {
    name = 'local'
    cpus = 16  // Adjust based on your system
    memory = '32 GB'  // Adjust based on your system
}

// Capture Nextflow log files
timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_timeline.html"
}
report {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_report.html"
}
trace {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_trace.txt"
}
dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/pipeline_dag.svg"
}

// Manifest
manifest {
    name = 'yeast-alignment-pipeline'
    author = 'KochInstitute-Bioinformatics'
    homePage = 'https://github.com/KochInstitute-Bioinformatics/yeast-alignment-pipeline'
    description = 'Simple Nextflow pipeline for yeast DNA alignment with vector detection'
    mainScript = 'main.nf'
    nextflowVersion = '>=23.04.0'
    version = '1.0.0'
}